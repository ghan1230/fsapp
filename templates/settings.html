<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API í‚¤ ì„¤ì •</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            margin: 0;
            padding: 0;
        }
        .header {
            background: #1a1f36;
            color: white;
            padding: 20px 40px;
            border-bottom: 1px solid #2d3748;
        }
        .header h1 {
            font-size: 1.8em;
            margin-bottom: 8px;
            font-weight: 600;
            letter-spacing: -0.5px;
        }
        .header p {
            font-size: 0.95em;
            opacity: 0.7;
            margin-bottom: 15px;
            font-weight: 400;
        }
        .nav-links {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .nav-links a {
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            padding: 8px 16px;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 0.9em;
        }
        .nav-links a:hover {
            background: rgba(255,255,255,0.1);
            color: white;
            border-color: rgba(255,255,255,0.2);
        }
        .nav-links a.active {
            background: #3182ce;
            color: white;
            border-color: #3182ce;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 40px;
        }
        h1 {
            color: #1a1f36;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #718096;
            margin-bottom: 30px;
        }
        .api-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 4px solid #3182ce;
        }
        .api-section h3 {
            margin-top: 0;
            color: #2d3748;
        }
        .api-section p {
            color: #718096;
            font-size: 0.9em;
            margin: 10px 0;
        }
        .api-section a {
            color: #3182ce;
            text-decoration: none;
        }
        .api-section a:hover {
            text-decoration: underline;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #2d3748;
            font-weight: 500;
        }
        input[type="text"], input[type="password"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }
        input[type="text"]:focus, input[type="password"]:focus {
            outline: none;
            border-color: #3182ce;
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
        }
        .required {
            color: #e53e3e;
        }
        .optional {
            color: #718096;
            font-size: 0.85em;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }
        button {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-save {
            background: #3182ce;
            color: white;
        }
        .btn-save:hover {
            background: #2c5aa0;
        }
        .btn-test {
            background: #48bb78;
            color: white;
        }
        .btn-test:hover {
            background: #38a169;
        }
        .btn-clear {
            background: #e53e3e;
            color: white;
        }
        .btn-clear:hover {
            background: #c53030;
        }
        .message {
            padding: 12px;
            border-radius: 6px;
            margin-top: 20px;
            display: none;
        }
        .message.success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }
        .message.error {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #fc8181;
        }
        .message.info {
            background: #bee3f8;
            color: #2c5282;
            border: 1px solid #90cdf4;
        }
        .privacy-notice {
            background: #fef5e7;
            border: 1px solid #f9e79f;
            border-radius: 6px;
            padding: 15px;
            margin-top: 20px;
        }
        .privacy-notice h4 {
            margin-top: 0;
            color: #7d6608;
        }
        .privacy-notice p {
            color: #7d6608;
            font-size: 0.9em;
            margin: 5px 0;
        }
        .back-link {
            display: inline-block;
            margin-top: 20px;
            color: #3182ce;
            text-decoration: none;
        }
        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>âš™ï¸ API í‚¤ ì„¤ì •</h1>
        <p>ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤</p>
        <div class="nav-links">
            <a href="/">í•œêµ­ ì£¼ì‹</a>
            <a href="/us_stocks">ë¯¸êµ­ ì£¼ì‹</a>
            <a href="/compare">ë¹„êµ ë¶„ì„</a>
            <a href="/settings" class="active">âš™ï¸ API í‚¤ ì„¤ì •</a>
        </div>
    </div>
    
    <div class="container">
        <p class="subtitle">í‚¤ëŠ” ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë˜ë©° ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>

        <div class="api-section">
            <h3>ğŸ‡°ğŸ‡· Open DART API <span class="required">*í•„ìˆ˜</span></h3>
            <p>í•œêµ­ ì£¼ì‹ ì¬ë¬´ì œí‘œ ì¡°íšŒì— í•„ìš”í•©ë‹ˆë‹¤.</p>
            <p>ë°œê¸‰: <a href="https://opendart.fss.or.kr/" target="_blank">https://opendart.fss.or.kr/</a></p>
            <label for="dartKey">API í‚¤:</label>
            <input type="password" id="dartKey" placeholder="Open DART API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        </div>

        <div class="api-section">
            <h3>ğŸ‡ºğŸ‡¸ Finnhub API <span class="required">*í•„ìˆ˜</span></h3>
            <p>ë¯¸êµ­ ì£¼ì‹ ì •ë³´, ë‰´ìŠ¤, ë™ì¢… ì—…ê³„ ë¹„êµì— í•„ìš”í•©ë‹ˆë‹¤.</p>
            <p>ë°œê¸‰: <a href="https://finnhub.io/register" target="_blank">https://finnhub.io/register</a> (ë¬´ë£Œ)</p>
            <label for="finnhubKey">API í‚¤:</label>
            <input type="password" id="finnhubKey" placeholder="Finnhub API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        </div>

        <div class="api-section">
            <h3>ğŸ¤– Gemini AI API <span class="optional">(ì„ íƒì‚¬í•­)</span></h3>
            <p>AI ì¬ë¬´ì œí‘œ ë¶„ì„ ê¸°ëŠ¥ì— í•„ìš”í•©ë‹ˆë‹¤. ì—†ì–´ë„ ë‹¤ë¥¸ ê¸°ëŠ¥ì€ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
            <p>ë°œê¸‰: <a href="https://aistudio.google.com/app/apikey" target="_blank">https://aistudio.google.com/app/apikey</a> (ë¬´ë£Œ)</p>
            <label for="geminiKey">API í‚¤:</label>
            <input type="password" id="geminiKey" placeholder="Gemini API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­)">
        </div>

        <div class="button-group">
            <button class="btn-save" onclick="saveKeys()">ğŸ’¾ ì €ì¥</button>
            <button class="btn-test" onclick="testKeys()">ğŸ§ª í…ŒìŠ¤íŠ¸</button>
            <button class="btn-clear" onclick="clearKeys()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
        </div>

        <div id="message" class="message"></div>

        <div class="privacy-notice">
            <h4>ğŸ”’ ê°œì¸ì •ë³´ ë³´í˜¸</h4>
            <p>âœ… API í‚¤ëŠ” ë¸Œë¼ìš°ì €ì˜ localStorageì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤</p>
            <p>âœ… ì„œë²„ë¡œ ì „ì†¡ë˜ê±°ë‚˜ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤</p>
            <p>âœ… ë‹¤ë¥¸ ì‚¬ìš©ìì™€ ê³µìœ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤</p>
            <p>âš ï¸ ê³µìš© ì»´í“¨í„°ì—ì„œëŠ” ì‚¬ìš© í›„ ë°˜ë“œì‹œ ì´ˆê¸°í™”í•˜ì„¸ìš”</p>
        </div>

    </div>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ í‚¤ ë¶ˆëŸ¬ì˜¤ê¸°
        window.onload = function() {
            const dartKey = localStorage.getItem('OPEN_DART_API_KEY');
            const finnhubKey = localStorage.getItem('FINNHUB_API_KEY');
            const geminiKey = localStorage.getItem('GEMINI_API_KEY');

            if (dartKey) document.getElementById('dartKey').value = dartKey;
            if (finnhubKey) document.getElementById('finnhubKey').value = finnhubKey;
            if (geminiKey) document.getElementById('geminiKey').value = geminiKey;

            // í‚¤ê°€ ì €ì¥ë˜ì–´ ìˆìœ¼ë©´ ì•Œë¦¼
            if (dartKey || finnhubKey) {
                showMessage('ì €ì¥ëœ API í‚¤ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.', 'info');
            }
        };

        function saveKeys() {
            const dartKey = document.getElementById('dartKey').value.trim();
            const finnhubKey = document.getElementById('finnhubKey').value.trim();
            const geminiKey = document.getElementById('geminiKey').value.trim();

            // í•„ìˆ˜ í‚¤ í™•ì¸
            if (!dartKey || !finnhubKey) {
                showMessage('Open DART API í‚¤ì™€ Finnhub API í‚¤ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.', 'error');
                return;
            }

            // localStorageì— ì €ì¥
            localStorage.setItem('OPEN_DART_API_KEY', dartKey);
            localStorage.setItem('FINNHUB_API_KEY', finnhubKey);
            if (geminiKey) {
                localStorage.setItem('GEMINI_API_KEY', geminiKey);
            }

            showMessage('âœ… API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ì´ì œ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'success');
            
            // 3ì´ˆ í›„ ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
            setTimeout(() => {
                window.location.href = '/';
            }, 2000);
        }

        async function testKeys() {
            const dartKey = document.getElementById('dartKey').value.trim();
            const finnhubKey = document.getElementById('finnhubKey').value.trim();
            const geminiKey = document.getElementById('geminiKey').value.trim();

            if (!dartKey && !finnhubKey) {
                showMessage('í…ŒìŠ¤íŠ¸í•  API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }

            showMessage('API í‚¤ í…ŒìŠ¤íŠ¸ ì¤‘...', 'info');

            try {
                const response = await fetch('/api/test_keys', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        dart_key: dartKey,
                        finnhub_key: finnhubKey,
                        gemini_key: geminiKey
                    })
                });

                const result = await response.json();

                if (response.ok) {
                    let message = 'âœ… í…ŒìŠ¤íŠ¸ ê²°ê³¼:\n';
                    if (result.dart) message += '\nâœ“ Open DART API: ì •ìƒ';
                    else if (dartKey) message += '\nâœ— Open DART API: ì‹¤íŒ¨';
                    
                    if (result.finnhub) message += '\nâœ“ Finnhub API: ì •ìƒ';
                    else if (finnhubKey) message += '\nâœ— Finnhub API: ì‹¤íŒ¨';
                    
                    if (result.gemini) message += '\nâœ“ Gemini AI API: ì •ìƒ';
                    else if (geminiKey) message += '\nâœ— Gemini AI API: ì‹¤íŒ¨';

                    showMessage(message, result.dart && result.finnhub ? 'success' : 'error');
                } else {
                    showMessage('âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + result.error, 'error');
                }
            } catch (error) {
                showMessage('âŒ í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message, 'error');
            }
        }

        function clearKeys() {
            if (confirm('ì €ì¥ëœ ëª¨ë“  API í‚¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('OPEN_DART_API_KEY');
                localStorage.removeItem('FINNHUB_API_KEY');
                localStorage.removeItem('GEMINI_API_KEY');

                document.getElementById('dartKey').value = '';
                document.getElementById('finnhubKey').value = '';
                document.getElementById('geminiKey').value = '';

                showMessage('ğŸ—‘ï¸ ëª¨ë“  API í‚¤ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
            }
        }

        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = 'message ' + type;
            messageDiv.style.display = 'block';

            // 5ì´ˆ í›„ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>
